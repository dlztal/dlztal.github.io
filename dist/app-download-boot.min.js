"use strict";function appDownloadBoot(t){this.isWeixin=!!/MicroMessenger/gi.test(navigator.userAgent),this.isAndroid=!!navigator.userAgent.match(/android/gi),this.isIos=!!navigator.userAgent.match(/(iphone|ipod|ios|ipad)/gi),this.iosVersion=this.getIosVersion(),this.opts={},this.concatOptions(t),this.createIosMeta()}var fn=appDownloadBoot.prototype;fn.concatOptions=function(t){t=t instanceof Object?t:{};for(var i in t)this.opts[i]=t[i];var o={android:{file:null,schema:null,yyb:null},ios:{appid:null,schema:null,appstore:null},site:null,url:null};for(var s in o)if(this.opts[s]||(this.opts.callback&&this.opts.callback({code:1,msg:s+" 未配置"}),this.opts[s]=o[s]),o[s]instanceof Object)for(var e in o[s]){var a=o[s][e];try{this.opts[s][e]||(this.opts.callback&&this.opts.callback({code:2,msg:s+"属性"+e+" 未配置"}),this.opts[s][e]=a)}catch(t){}}},fn.download=function(){var t=this;if(!this.isAndroid&&!this.isIos)return this.opts.callback&&this.opts.callback({code:7,msg:"非移动设备"}),void(window.location.href=this.opts.site);var i=this.opts.android||{},o=this.opts.ios||{};if(this.isAndroid)this.tryStarting(i.schema,function(o){o.code>0&&(t.isWeixin?window.location.href=i.yyb:t.createIframe(i.file,function(t){t.code>0&&(window.location.href=this.opts.site)}))}),this.opts.callback&&this.opts.callback({code:5,msg:"andriod设备"});else if(this.isIos){if(this.iosVersion>=9){window.location.href=this.opts.url?o.schema+"?url="+this.opts.url:o.schema;var s=setTimeout(function(){window.alert("即将进入appStore！"),window.location.href=o.appstore,clearTimeout(s)},500);return}this.tryStarting(o.schema,function(t){t.code>0&&(window.location.href=o.appstore)}),this.opts.callback&&this.opts.callback({code:6,msg:"ios设备"})}},fn.tryStarting=function(t,i){var o=this;t?(this.createIframe(t,function(s){i&&i(s),0===s.code?o.opts.callback&&o.opts.callback({code:3,msg:"启动App成功"}):o.opts.callback&&o.opts.callback({code:4,msg:"启动App失败 "+t})}),this.opts.callback&&this.opts.callback({code:8,msg:"尝试启动app: "+t})):this.opts.callback&&this.opts.callback({code:9,msg:"未配置schema协议"})},fn.getIosVersion=function(){return/OS (\d+)/gi.test(navigator.userAgent)?RegExp.$1:0},fn.createIosMeta=function(){if(this.isIos){var t=this.opts.ios.appid,i=document.createElement("meta");i.setAttribute("name","apple-itunes-app"),i.setAttribute("content","app-id='"+t+"', affiliate-data=myAffiliateData, app-argument='"+t+"'"),document.querySelector("head").appendChild(i)}},fn.createIframe=function(t,i){var o=document.createElement("iframe");o.style.cssText="display:none;width=0;height=0",o.src=t,document.body.appendChild(o);var s=setTimeout(function(){i&&i({code:2,msg:"overtime"}),clearTimeout(s)},3e3);o.onload=function(){clearTimeout(s),i&&i({code:0,msg:"success"})},o.onerror=function(){clearTimeout(s),i&&i({code:1,msg:"error"})};var e=setTimeout(function(){document.body.removeChild(o),clearTimeout(e)},1500)};